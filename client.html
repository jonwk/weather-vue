<!-- 
TODO:
- City Input
- API Return
    - Packing: 
        - umbrealla if there is rain anytime over the next 4-days
        - Cold - Temp < 12C
        - Mild - 12C <= Temp <= 24C
        - Hot - Temp > 24C
    - Summary of next 4 days showing: 
        - Temperature
        - Wind Speed
        - Rainfall level.
    - Air Pollution - PM2_5 forecast for the next 5 days
        - advise the user to wear a mask if PM2_5 > 10
    - One Innovative Feature 

 -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <script type="importmap">
        {
            "imports": {
                "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js"
            }
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
    <div id="app">
        <h1 class="text-4xl font-semibold">Weather App</h1>
        <br />
        <p>Please enter the town you are seeking the forecast of:</p>
        <input v-model="town" placeholder="Town Name" />
        <button v-on:click="getWeatherForTown"
            class="h-10 px-6 font-semibold rounded-full bg-violet-600 text-white">Show me the weather!</button>
        <span v-if="isError">
            <br />
            <br />
            <font color="red">{{errorMessage}}</font>
        </span>

        <!-- Rain Packing Tips -->
        <div v-if="!isError && isRain != null">
            <p>
                <b>Rain:</b>
                <span v-if="isRain">There is rain forecast during these dates. You should pack an umberella.</span>
                <span v-if="!isRain">There is no rain forecast during these dates. No need to pack an umberella!.</span>
            </p>
        </div>

        <!-- Weather Sentiment Packing Tips -->
        <div v-if="!isError && temperatureSummary != null">
            <p>
                <b>Packing:</b>
                <span v-if="temperatureSummary.sentiment == 'hot'">Temperature range is >20°C. You should pack light
                    clothes
                    as to keep cool.</span>
                <span v-if="temperatureSummary.sentiment == 'warm'">Temperature range is between
                    {{temperatureSummary.max}}°C and {{temperatureSummary.min}}°C. You should pack both light clothes
                    with
                    some extra layers for when it gets colder.</span>
                <span v-if="temperatureSummary.sentiment == 'cold'">Temperature range is between
                    {{temperatureSummary.max}}°C and {{temperatureSummary.min}}°C. You should pack warm clothes with
                    plenty
                    of insulation to keep warm.</span>
            </p>
        </div>

        <!-- Mask Advise -->
        <div v-if="!isError && maskAdvised != null">
            <p>
                <b>Mask Advise:</b>
                <span v-if="maskAdvised">High Air Pollution Expected (PM2_5 > 10). You should wear a Mask
                    outside.</span>
                <span v-if="!maskAdvised">There is not much air pollution these dates. No need to wear a mask!.</span>
            </p>
        </div>

        <table v-if="forecastJson">
            <thead>
                <tr>
                    <th scope="col">Date</th>
                    <th scope="col">Avg Temperature (°C)</th>
                    <th scope="col">Avg Wind Speed (m/s)</th>
                    <th scope="col">Avg PM2_5</th>
                    <th scope="col">Rainfall Level (mm)</th>
                    <th scope="col">Min Temperature (°C)</th>
                    <th scope="col">Max Temperature (°C)</th>
                </tr>
            </thead>
            <tbody>
                <template v-for="(dateEntry, date) in forecastJson">
                    <tr>
                        <th scope="row">{{ date }}</th>
                        <td>{{ dateEntry.averageTemp }}</td>
                        <td>{{ dateEntry.averageWind }}</td>
                        <td>{{ dateEntry.averagePM2_5 }}</td>
                        <td>{{ dateEntry.rainfallLevels }}</td>
                        <td>{{ dateEntry.temperatureRange.min }}</td>
                        <td>{{ dateEntry.temperatureRange.max }}</td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>
</body>

</html>


<script type="module">
    import { createApp } from 'vue'
    createApp({
        data() {
            return {
                message: '',
                count: 0,
                town: '',
                isError: false,
                errorMessage: '',
                forecastJson: null,
                isRain: null,
                maskAdvised: null,
                temperatureSummary: null,
                townSearchHistory: []
            }
        },
        methods: {
            increment() {
                // update component state
                this.count++
            },
            getWeatherForTown() {
                console.log(`Getting weather for town ${this.town}...`);

                fetch(`http://localhost:3000/forecast/${this.town}`)
                    .then(response => {
                        // // First check that there are no errors
                        if (response.status === 200) return response.json();
                        else throw Error(response.statusText);
                    }).then(responseJSON => {
                        console.log(responseJSON);
                        this.forecastJson = responseJSON.forecastSummary;
                        this.temperatureSummary = responseJSON.temperatureSummary;
                        this.isRain = responseJSON.isRain;
                        this.maskAdvised = responseJSON.maskAdvised;

                        // Reset any errors
                        this.isError = false;
                        this.errorMessage = '';
                    })
                    .catch(error => {
                        console.error(error);

                        // Set error messages
                        this.isError = true;
                        this.errorMessage = `Unable to fetch weather data for ${this.town}`;
                    });
            }
        }
    }).mount('#app')
</script>